{ config, pkgs, ... }:

{
  imports = [ ./hardware-configuration.nix ];

  # Bootloader（UEFI 默认）
  boot.loader.systemd-boot.enable = true;
  boot.loader.efi.canTouchEfiVariables = true;

  # 主机名与网络
  networking.hostName = "nixos";                  # 改成你喜欢的
  networking.networkmanager.enable = true;

  # 时区与中文支持
  time.timeZone = "Asia/Shanghai";
  i18n.defaultLocale = "zh_CN.UTF-8";
  console = {
    font = "${pkgs.terminus_font}/share/consolefonts/ter-u28n.psf.gz";
    useXkbConfig = true;
  };

  # 国内加速（永久生效）
nix.settings = {
  substituters = [
    "https://mirrors.ustc.edu.cn/nix-channels/store"     # 中科大（可优先）
    "https://mirrors.tuna.tsinghua.edu.cn/nix-channels/store"  # 清华
    "https://cache.nixos.org/"
  ];
  trusted-public-keys = [
    "cache.nixos.org-1:6NCHdD59X431o0gWypbMrAURkbJ16ZPMQFGspcDShjY="
  ];
};

  # 普通用户（务必改用户名和初始密码）
  users.users.zxh = {                            # ← 改成你的用户名
    isNormalUser = true;
    extraGroups = [ "wheel" "networkmanager" ];
    initialPassword = "217578qwe";                 # 登录后立即改密码！
  };
  #字体
  fonts = {
  fontconfig.enable = true;
  fontDir.enable = true;

  packages = with pkgs; [
    jetbrains-mono
    inter
    noto-fonts
    noto-fonts-cjk-sans
    noto-fonts-cjk-serif
    noto-fonts-color-emoji
  ];

  fontconfig.defaultFonts = {
    monospace = [ "JetBrains Mono" "Noto Sans Mono CJK SC" ];
    sansSerif = [ "Inter" "Noto Sans CJK SC" "Noto Sans" ];
    serif = [ "Noto Serif CJK SC" "Noto Serif" ];
  };
};

  environment.systemPackages = with pkgs; [
  #基本工具
    btop
    htop
    neovim
    git
    wget
    curl
    #互联网
    firefox
    #hypland
    waybar			#状态栏
    rofi-wayland		#应用启动器
    swww			#壁纸工具
    networkmanagerapplet	#网络托盘
    brightnessctl		#亮度控制
    pavucontrol			#音量控制
  ];
  # fcitx 输入法
   i18n.inputMethod = {
   type = "fcitx5";
   enable = true;
   fcitx5.addons = with pkgs; [
     qt6Packages.fcitx5-chinese-addons  # 使用拼音输入法
     fcitx5-mozc
     fcitx5-gtk
   ];
 };
  # 桌面环境（根据下载的 ISO 启用一个）
  
  # KDE Plasma
  # services.desktopManager.plasma6.enable = true;
  #hpyland
  programs.hyprland = {
    # Install the packages from nixpkgs
    enable = true;
    # Whether to enable XWayland
    xwayland.enable = true;
  };
  # 环境变量（Wayland 友好）
  environment.sessionVariables = {
    NIXOS_OZONE_WL = "1";           # Electron 程序 Wayland 支持
    QT_QPA_PLATFORM = "wayland";
    GDK_BACKEND = "wayland";
  };
  # 门户（文件选择、截图等）
  xdg.portal.enable = true;
  xdg.portal.extraPortals = [ pkgs.xdg-desktop-portal-hyprland ];
  # GNOME（GNOME ISO 用）
   services.xserver.enable = true;
   services.xserver.desktopManager.gnome.enable = true;
  #sddm
  services.displayManager.sddm = {
  enable = true;

  wayland = {
    enable = true;

    # default compositor is "weston", you can optionally change it to kwin
    #compositor = "kwin";
    };
  };
  # SSH 服务
  services.openssh.enable = true;

  # 系统版本（当前最新稳定版 25.11）
  system.stateVersion = "25.11";
}
